# update_playlist.py
import requests
import os

# é…ç½®ä¿¡æ¯ - åŸºäºä½ æä¾›çš„Gist
GIST_ID = "1eefb097a9b3ec25c79bbd4149066d41"  # ä½ çš„Gist ID
GH_TOKEN = os.environ['GH_PAT']  # ä»ä»“åº“å¯†é’¥ä¸­è¯»å–Token

# æ„å»ºæœ€æ–°çš„M3Uå†…å®¹
# è¿™æ˜¯ä¸€ä¸ªåŸºç¡€ç¤ºä¾‹ï¼Œä½ å¯ä»¥åç»­æ‰©å±•
new_content = """#EXTM3U
# æˆ‘çš„è‡ªåŠ¨æ›´æ–°IPTVåˆ—è¡¨
# ç”±GitHub Actionsè‡ªåŠ¨ç”Ÿæˆ

#EXTINF:-1, Example Channel 1
http://example.com/ch1.m3u8
#EXTINF:-1, Example Channel 2  
http://example.com/ch2.m3u8"""

# é€šè¿‡APIæ›´æ–°Gist
gist_url = f"https://api.github.com/gists/{GIST_ID}"
headers = {
    "Authorization": f"token {GH_TOKEN}",
    "Accept": "application/vnd.github.v3+json"
}
data = {
    "files": {
        "my_iptv_list.m3u": {  # ä½¿ç”¨ä½ åœ¨Gistä¸­åˆ›å»ºçš„æ–‡ä»¶å
            "content": new_content
        }
    }
}

response = requests.patch(gist_url, headers=headers, json=data)
if response.status_code == 200:
    print("âœ… Gistæ›´æ–°æˆåŠŸï¼")
    print(f"ğŸ“ æ›´æ–°å†…å®¹é•¿åº¦: {len(new_content)} å­—ç¬¦")
else:
    print(f"âŒ Gistæ›´æ–°å¤±è´¥: {response.status_code}")
    print(f"é”™è¯¯ä¿¡æ¯: {response.text}")
